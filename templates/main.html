<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signature Verification</title>
    <link rel="stylesheet" href="./css/main.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="https://i.pinimg.com/564x/05/8c/02/058c02ca15b75b634b40fcdbf36f5a5f.jpg" alt="Logo">
            <h1>Signature Verification</h1>
        </div>
        <ul class="nav-links">
            <li><a href="./index.html">Home</a></li>
            <li><a href="./login.html">Login</a></li>
            <li><a href="./signup.html">Signup</a></li>
            <li><a href="./profile.html">Profile</a></li>
            <li class="mode-toggle" onclick="toggleMode()">
                <img id="moonIcon" src="https://i.pinimg.com/564x/c2/1b/06/c21b068e9cc106913f482690dcd104fa.jpg" alt="Moon Mode" class="mode-icon">
            </li>
            
        </ul>
    </nav>
    <div class="welcome flex-section">
        <div class="intro flex-item">
            <h2>Signature Verification</h2>
            <p>
                Signature verification is a vital security measure used to confirm an individual's identity and authenticate documents.
            </p>
            <div class="container">
                <div id="boxmain">
                    <div id="box1">
                <form id="uploadForm" enctype="multipart/form-data">
                    <label for="username" style="margin-bottom: 10px;"><spam>Enter Username</spam></label><br>
                    <input type="text" name="username" id="username" accept="name/*" placeholder="enter username" class="user"></div>
                    
    
                <div id="box2">
                    <label for="signatureFile"><spam>Upload Signature</spam></label><br>
                    <input type="file" name="file" id="signatureFile" accept="image/*" required></div></div>

                    <button id="mainbutton" type="submit" class="btn">Verify</button>
                  </form>
        
                <!-- New div to display the uploaded image -->
                <div id="uploadedImageSection" class="uploaded-image-section" style="display: none;">
                    <h3>Uploaded Image:</h3>
                    <img id="uploadedImage" src="" alt="Uploaded Image" class="uploaded-image">
                </div>
        
                <!-- Section to display the result -->
                <div id="resultSection" style="display: none;">
                    <p id="result"></p>
                </div>
            </div>
            
        </div>
    </div>
    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (event) => {
    event.preventDefault(); // Prevent form submission

    const formData = new FormData();
    const fileInput = document.getElementById('signatureFile');
    const usernameInput = document.getElementById('username');

    // Validate the username
    if (!usernameInput.value.trim()) {
        alert('Please enter a valid username.');
        return;
    }

    if (!fileInput.files[0]) {
        alert('Please select a file to upload.');
        return;
    }

    // Append both username and file to form data
    formData.append('file', fileInput.files[0]);
    formData.append('username', usernameInput.value.trim()); // Add username to formData

    try {
        const response = await fetch('/predict', {
            method: 'POST',
            body: formData,
        });

        if (response.ok) {
            const result = await response.json();

            const resultText = document.getElementById('result');
            const resultSection = document.getElementById('resultSection');
            const uploadedImage = document.getElementById('uploadedImage');
            const uploadedImageSection = document.getElementById('uploadedImageSection');

            // Display the uploaded image
            const reader = new FileReader();
            reader.onload = function (e) {
                uploadedImage.src = e.target.result;
            };

            reader.readAsDataURL(fileInput.files[0]);

            // Display the image section
            uploadedImageSection.style.display = 'block';

            // Set the result text content
            resultText.textContent = `Label: ${result.label}, Confidence: ${result.confidence}`;

            // Apply styling based on result
            if (result.label.toLowerCase() === 'genuine') {
                resultText.classList.add('genuine');
                resultText.classList.remove('forged');
            } else {
                resultText.classList.add('forged');
                resultText.classList.remove('genuine');
            }

            // Display the result section
            resultSection.style.display = 'block';
        } else {
            const error = await response.json();
            alert(`Failed to verify signature: ${error.error}`);
        }
    } catch (err) {
        console.error('Error uploading image:', err);
        alert('Failed to upload the image. Please try again.');
    }
});

  
function toggleMode() {
            document.body.classList.toggle("dark-mode");
            document.getElementById("toggle").textContent = document.body.classList.contains("dark-mode") ? "ðŸŒž" : "ðŸŒ™";
        }
</script>
</body>
</html>